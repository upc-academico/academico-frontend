<div class="register-outer-container">
    <div class="register-content">


        <div class="register-card">
            <h2 class="register-title">Crear Cuenta</h2>
            <p class="register-subtitle">Complete los siguientes datos para registrarse</p>

            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">

                <div class="form-row">
                    <!-- DNI -->
                    <mat-form-field class="half-width" appearance="outline">
                        <mat-label>DNI</mat-label>
                        <input matInput placeholder="12345678" formControlName="dni" maxlength="8">
                        <mat-icon matPrefix>badge</mat-icon>
                        <mat-error *ngIf="registerForm.get('dni')?.hasError('required')">
                            Obligatorio
                        </mat-error>
                        <mat-error *ngIf="registerForm.get('dni')?.hasError('pattern')">
                            Solo números
                        </mat-error>
                        <mat-error *ngIf="registerForm.get('dni')?.hasError('minlength')">
                            8 dígitos
                        </mat-error>
                    </mat-form-field>

                    <!-- Celular -->
                    <mat-form-field class="half-width" appearance="outline">
                        <mat-label>Celular</mat-label>
                        <input matInput placeholder="999999999" formControlName="celular" maxlength="9">
                        <mat-icon matPrefix>phone</mat-icon>
                        <mat-error *ngIf="registerForm.get('celular')?.hasError('required')">
                            Obligatorio
                        </mat-error>
                        <mat-error *ngIf="registerForm.get('celular')?.hasError('pattern')">
                            Solo números
                        </mat-error>
                    </mat-form-field>
                </div>

                <!-- Nombres -->
                <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Nombres</mat-label>
                    <input matInput placeholder="Ingrese sus nombres" formControlName="nombres">
                    <mat-icon matPrefix>person</mat-icon>
                    <mat-error *ngIf="registerForm.get('nombres')?.hasError('required')">
                        Los nombres son obligatorios
                    </mat-error>
                </mat-form-field>

                <!-- Apellidos -->
                <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Apellidos</mat-label>
                    <input matInput placeholder="Ingrese sus apellidos" formControlName="apellidos">
                    <mat-icon matPrefix>person_outline</mat-icon>
                    <mat-error *ngIf="registerForm.get('apellidos')?.hasError('required')">
                        Los apellidos son obligatorios
                    </mat-error>
                </mat-form-field>

                <!-- Email -->
                <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Correo Electrónico</mat-label>
                    <input matInput type="email" placeholder="ejemplo@correo.com" formControlName="email">
                    <mat-icon matPrefix>email</mat-icon>
                    <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
                        El correo es obligatorio
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
                        Correo inválido
                    </mat-error>
                </mat-form-field>

                <!-- Username -->
                <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Nombre de Usuario</mat-label>
                    <input matInput placeholder="usuario123" formControlName="username">
                    <mat-icon matPrefix>account_circle</mat-icon>
                    <mat-error *ngIf="registerForm.get('username')?.hasError('required')">
                        El usuario es obligatorio
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('username')?.hasError('minlength')">
                        Mínimo 4 caracteres
                    </mat-error>
                </mat-form-field>

                <div class="form-row">
                    <!-- Password -->
                    <mat-form-field class="half-width" appearance="outline">
                        <mat-label>Contraseña</mat-label>
                        <input [type]="hidePassword ? 'password' : 'text'" matInput placeholder="••••••"
                            formControlName="password">
                        <mat-icon matPrefix>lock</mat-icon>
                        <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
                            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                            Obligatoria
                        </mat-error>
                        <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                            Mín. 6 caracteres
                        </mat-error>
                    </mat-form-field>

                    <!-- Confirmar Password -->
                    <mat-form-field class="half-width" appearance="outline">
                        <mat-label>Confirmar</mat-label>
                        <input [type]="hideConfirmPassword ? 'password' : 'text'" matInput placeholder="••••••"
                            formControlName="confirmPassword">
                        <mat-icon matPrefix>lock_outline</mat-icon>
                        <button mat-icon-button matSuffix type="button"
                            (click)="hideConfirmPassword = !hideConfirmPassword">
                            <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
                            Confirme
                        </mat-error>
                        <mat-error
                            *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched">
                            No coinciden
                        </mat-error>
                    </mat-form-field>
                </div>

                <!-- Role (solo si es admin) -->
                <mat-form-field class="full-width" appearance="outline" *ngIf="isAdmin">
                    <mat-label>Rol</mat-label>
                    <mat-select formControlName="role">
                        <mat-option value="USER">Usuario</mat-option>
                        <mat-option value="ADMIN">Administrador</mat-option>
                    </mat-select>
                    <mat-icon matPrefix>admin_panel_settings</mat-icon>
                </mat-form-field>

                <!-- Mensajes -->
                <div class="error-message" *ngIf="errorMessage">
                    <mat-icon>error</mat-icon>
                    <span>{{ errorMessage }}</span>
                </div>

                <div class="success-message" *ngIf="successMessage">
                    <mat-icon>check_circle</mat-icon>
                    <span>{{ successMessage }}</span>
                </div>

                <!-- Botón de Registro -->
                <button mat-raised-button color="primary" type="submit" class="register-button full-width"
                    [disabled]="!registerForm.valid || isLoading">
                    <!-- <mat-spinner diameter="20" *ngIf="isLoading" class="spinner"></mat-spinner> -->
                    <span *ngIf="!isLoading">Registrarse</span>
                </button>
            </form>

            <div class="register-footer">
                <span>¿Ya tienes cuenta? </span>
                <a routerLink="/components/login" class="login-link">Iniciar Sesión</a>
            </div>
        </div>
    </div>
</div>